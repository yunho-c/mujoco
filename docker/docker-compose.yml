services:
  mujoco-android:
    build:
      context: .
      dockerfile: Dockerfile.android
    image: mujoco-android:latest
    environment:
      ANDROID_HOME: /opt/android-sdk
      ANDROID_NDK_HOME: /opt/android-sdk/ndk/26.2.11394342
    volumes:
      - ..:/workspace
    working_dir: /workspace
    command: >
      bash -lc "
        cmake -S . -B build-android
          -G Ninja
          -DCMAKE_TOOLCHAIN_FILE=$ANDROID_NDK_HOME/build/cmake/android.toolchain.cmake
          -DANDROID_ABI=arm64-v8a
          -DANDROID_PLATFORM=android-24
          -DMUJOCO_ENABLE_AVX=OFF
          -DMUJOCO_ENABLE_AVX_INTRINSICS=OFF
          -DMUJOCO_BUILD_EXAMPLES=OFF
          -DMUJOCO_BUILD_TESTS=OFF
          -DMUJOCO_USE_FILAMENT=OFF
          -DBUILD_SHARED_LIBS=ON
        cmake --build build-android --target mujoco
      "
